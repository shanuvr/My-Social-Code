openapi: 3.0.0
info:
  title: MySocialCode API
  description: Real-world social experiences - safe, small-group events that build belonging
  version: 1.0.0
  contact:
    name: MySocialCode Support
    email: support@mysocialcode.com

servers:
  - url: http://localhost:3000/api
    description: Local development
  - url: https://api.mysocialcode.com
    description: Production

tags:
  - name: Auth
    description: Phone OTP signup and authentication
  - name: Users
    description: User profile management and settings
  - name: Events
    description: Event creation, listing, and management
  - name: RSVP
    description: Join events and manage RSVPs
  - name: Check-in
    description: QR code validation and attendance tracking
  - name: Interests
    description: User interests and preferences
  - name: Business
    description: Business portal and management
  - name: Safety
    description: Reporting, blocking, and moderation
  - name: Admin
    description: Admin dashboard and moderation tools
  - name: System
    description: System health and status

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token received after OTP verification

paths:
  /auth/signup:
    post:
      tags: [Auth]
      summary: Send OTP to phone number
      description: User enters phone, receives 6-digit OTP via SMS
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [phone]
              properties:
                phone:
                  type: string
                  example: "+919876543210"
      responses:
        '200':
          description: OTP sent successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  request_id:
                    type: string
        '400':
          description: Invalid phone number
        '429':
          description: Too many attempts, try again later

  /auth/verify:
    post:
      tags: [Auth]
      summary: Verify OTP and create/login user
      description: User enters OTP received on phone, returns JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [phone, otp]
              properties:
                phone:
                  type: string
                  example: "+919876543210"
                otp:
                  type: string
                  example: "123456"
      responses:
        '200':
          description: User verified, logged in successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  token:
                    type: string
                  is_new_user:
                    type: boolean
        '400':
          description: Invalid OTP or expired
        '401':
          description: Verification failed

  /auth/register:
    post:
      tags: [Auth]
      summary: Register new user with profile and interests
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, interests]
              properties:
                name:
                  type: string
                  example: "John Doe"
                social_code:
                  type: string
                  example: "JOHN_2024"
                bio:
                  type: string
                date_of_birth:
                  type: string
                  format: date
                gender:
                  type: string
                  enum: [male, female, other, prefer_not_to_say]
                interests:
                  type: array
                  minItems: 1
                  items:
                    type: string
                looking_for:
                  type: string
                  enum: [friends, networking, dating]
                profile_photo_url:
                  type: string
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        '400':
          description: Invalid registration data
        '401':
          description: OTP not verified

  /auth/logout:
    post:
      tags: [Auth]
      summary: Logout user
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Logged out successfully

  /users/me:
    get:
      tags: [Users]
      summary: Get current user profile
      security:
        - BearerAuth: []
      responses:
        '200':
          description: User profile retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        '401':
          description: Unauthorized

    put:
      tags: [Users]
      summary: Update user profile
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                social_code:
                  type: string
                bio:
                  type: string
                profile_photo_url:
                  type: string
                date_of_birth:
                  type: string
                  format: date
                gender:
                  type: string
                  enum: [male, female, other, prefer_not_to_say]
      responses:
        '200':
          description: Profile updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        '400':
          description: Invalid data
        '401':
          description: Unauthorized

    delete:
      tags: [Users]
      summary: Delete account
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Account deleted successfully
        '401':
          description: Unauthorized

  /users/me/photo:
    post:
      tags: [Users]
      summary: Upload profile photo
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                photo:
                  type: string
                  format: binary
      responses:
        '200':
          description: Photo uploaded
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  photo_url:
                    type: string

  /users/me/settings:
    get:
      tags: [Users]
      summary: Get user settings
      security:
        - BearerAuth: []
      responses:
        '200':
          description: User settings
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  settings:
                    type: object
                    properties:
                      notifications_enabled:
                        type: boolean
                      email_notifications:
                        type: boolean
                      event_reminders:
                        type: boolean
                      show_profile:
                        type: boolean
                      allow_messages:
                        type: boolean

    put:
      tags: [Users]
      summary: Update user settings
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                notifications_enabled:
                  type: boolean
                email_notifications:
                  type: boolean
                event_reminders:
                  type: boolean
                show_profile:
                  type: boolean
                allow_messages:
                  type: boolean
      responses:
        '200':
          description: Settings updated

  /interests:
    get:
      tags: [Interests]
      summary: List all available interests
      responses:
        '200':
          description: List of interests
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  interests:
                    type: array
                    items:
                      type: object
                      properties:
                        interest_id:
                          type: string
                        name:
                          type: string
                        icon:
                          type: string

  /users/me/interests:
    get:
      tags: [Interests]
      summary: Get my interests
      security:
        - BearerAuth: []
      responses:
        '200':
          description: User's selected interests
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  interests:
                    type: array
                    items:
                      type: string

    put:
      tags: [Interests]
      summary: Update my interests
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [interests]
              properties:
                interests:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: Interests updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  interests:
                    type: array
                    items:
                      type: string

  /events:
    get:
      tags: [Events]
      summary: List all events with filters
      parameters:
        - name: latitude
          in: query
          schema:
            type: number
        - name: longitude
          in: query
          schema:
            type: number
        - name: radius_km
          in: query
          schema:
            type: integer
            default: 10
        - name: category
          in: query
          schema:
            type: string
            enum: [social, sports, learning, wellness, dining, arts]
        - name: date_from
          in: query
          schema:
            type: string
            format: date
        - name: women_only
          in: query
          schema:
            type: boolean
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: List of events
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  events:
                    type: array
                    items:
                      type: object
                      properties:
                        event_id:
                          type: string
                        title:
                          type: string
                        date:
                          type: string
                          format: date
                        time:
                          type: string
                        location_name:
                          type: string
                        distance_km:
                          type: number
                        current_attendees:
                          type: integer
                        capacity:
                          type: integer
                        category:
                          type: string
                        image_url:
                          type: string
                  total:
                    type: integer
                  page:
                    type: integer

    post:
      tags: [Events]
      summary: Create new event
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [title, description, date, time, latitude, longitude, capacity, category]
              properties:
                title:
                  type: string
                description:
                  type: string
                date:
                  type: string
                  format: date
                time:
                  type: string
                  format: time
                latitude:
                  type: number
                longitude:
                  type: number
                location_name:
                  type: string
                capacity:
                  type: integer
                category:
                  type: string
                  enum: [social, sports, learning, wellness, dining, arts]
                is_public:
                  type: boolean
                  default: true
                requires_approval:
                  type: boolean
                  default: false
                women_only:
                  type: boolean
                  default: false
                image_url:
                  type: string
      responses:
        '201':
          description: Event created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        '400':
          description: Invalid event data
        '401':
          description: Unauthorized

  /events/{event_id}:
    get:
      tags: [Events]
      summary: Get event details
      parameters:
        - name: event_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Event details
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        '404':
          description: Event not found

    put:
      tags: [Events]
      summary: Update event
      security:
        - BearerAuth: []
      parameters:
        - name: event_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: string
                date:
                  type: string
                  format: date
                time:
                  type: string
                  format: time
                location_name:
                  type: string
                latitude:
                  type: number
                longitude:
                  type: number
                capacity:
                  type: integer
                image_url:
                  type: string
      responses:
        '200':
          description: Event updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        '401':
          description: Only event host can update
        '404':
          description: Event not found

    delete:
      tags: [Events]
      summary: Cancel/Delete event
      security:
        - BearerAuth: []
      parameters:
        - name: event_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
      responses:
        '200':
          description: Event cancelled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        '401':
          description: Only event host can cancel
        '404':
          description: Event not found

  /events/{event_id}/attendees:
    get:
      tags: [Events]
      summary: Get event attendees list
      security:
        - BearerAuth: []
      parameters:
        - name: event_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of attendees
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  attendees:
                    type: array
                    items:
                      type: object
                      properties:
                        user_id:
                          type: string
                        name:
                          type: string
                        social_code:
                          type: string
                        rsvp_status:
                          type: string
                        joined_at:
                          type: string
                          format: date-time

  /users/me/events:
    get:
      tags: [Users]
      summary: Get events hosted by me
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Hosted events
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  events:
                    type: array
                    items:
                      type: object

  /events/{event_id}/rsvp:
    post:
      tags: [RSVP]
      summary: Join event (RSVP)
      security:
        - BearerAuth: []
      parameters:
        - name: event_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                guests_count:
                  type: integer
                  default: 1
      responses:
        '201':
          description: Successfully joined event
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        '400':
          description: Event full or already joined
        '401':
          description: User not authenticated

    delete:
      tags: [RSVP]
      summary: Cancel RSVP
      security:
        - BearerAuth: []
      parameters:
        - name: event_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: RSVP cancelled
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean

  /events/{event_id}/rsvps:
    get:
      tags: [RSVP]
      summary: Get all RSVPs for event (host only)
      security:
        - BearerAuth: []
      parameters:
        - name: event_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of RSVPs
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  rsvps:
                    type: array
                    items:
                      type: object

  /events/{event_id}/rsvps/{rsvp_id}:
    patch:
      tags: [RSVP]
      summary: Approve or reject RSVP (host only)
      security:
        - BearerAuth: []
      parameters:
        - name: event_id
          in: path
          required: true
          schema:
            type: string
        - name: rsvp_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                status:
                  type: string
                  enum: [approved, rejected]
      responses:
        '200':
          description: RSVP updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean

  /users/me/rsvps:
    get:
      tags: [Users]
      summary: Get events I joined
      security:
        - BearerAuth: []
      responses:
        '200':
          description: My RSVPs
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  rsvps:
                    type: array
                    items:
                      type: object

  /check-in/validate:
    post:
      tags: [Check-in]
      summary: Validate QR code and check-in
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [qr_code]
              properties:
                qr_code:
                  type: string
      responses:
        '200':
          description: Check-in successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        '400':
          description: Invalid QR or already checked in
        '404':
          description: QR not found

  /check-in/event/{event_id}:
    get:
      tags: [Check-in]
      summary: Get checked-in attendees (host only)
      security:
        - BearerAuth: []
      parameters:
        - name: event_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of checked-in attendees
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  checked_in:
                    type: array
                    items:
                      type: object
                  total:
                    type: integer

  /business/signup:
    post:
      tags: [Business]
      summary: Register as business
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [business_name, email, location_name, latitude, longitude]
              properties:
                business_name:
                  type: string
                email:
                  type: string
                location_name:
                  type: string
                latitude:
                  type: number
                longitude:
                  type: number
                description:
                  type: string
                website:
                  type: string
      responses:
        '201':
          description: Business registered
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean

  /business/profile:
    get:
      tags: [Business]
      summary: Get my business profile
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Business profile
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        '404':
          description: No business profile found

    put:
      tags: [Business]
      summary: Update business profile
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                business_name:
                  type: string
                description:
                  type: string
                website:
                  type: string
                location_name:
                  type: string
                latitude:
                  type: number
                longitude:
                  type: number
      responses:
        '200':
          description: Profile updated

  /business/dashboard:
    get:
      tags: [Business]
      summary: Get business dashboard analytics
      security:
        - BearerAuth: []
      parameters:
        - name: date_from
          in: query
          schema:
            type: string
            format: date
        - name: date_to
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Dashboard analytics
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean